<div class="container-fluid" id="create_inventory_confirmation_employees">

	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.all_clinics.sectionTitle %></h1>
	</div>

	<div class="alert alert-info mt-3 mb-2" style="display:none;" id="ERROR_BOX">
		<img src="assets/img/utils/info.png" class="alert-icon" alt="">
		<div class="alert-text" id="text"></div>
	</div>

	<div class="mt-3 app-block">

        <form action="" id="create_form">

            <div class="mb-2">
                <%- include(`${SETTINGS.UI_Settings.MAIN_DIR_NAME}/views/templates/select-inventory.template.ejs`, {
                    componentId: 'select_inventory_component',
                    selectId: "inventory_select",
                }) -%>
            </div>

            <div class="mb-2">
                <%- include(`${SETTINGS.UI_Settings.MAIN_DIR_NAME}/views/templates/select-employees2.template.ejs`, {
                    componentId: 'select_employee_component',
                    selectId: "employee_select",
                }) -%>
            </div>

            <div class="mb-5">

                <div class="mb-2">
                    <button type="button" class="btn btn-success" id="addToListBTN">
                        <%= UI_DISPLAY_LANG.views.pages.add_products.btn01 %>
                    </button>
                </div>

                <div class="" style="max-height: 500px;overflow-y: auto;overflow-x: hidden;">
                    <table class="table table-stripped table-hover js_deletable_list" id="tableElement">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th><%= UI_DISPLAY_LANG.views.pages.global.th71 %></th>
                                <th><%= UI_DISPLAY_LANG.views.pages.global.th11 %></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- <tr>
                                <td>
                                    <button class="btn-close"></button>
                                </td>
                                <td>name</td>
                                <td>desc</td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>

            </div>

            <div class="">
                <input type="submit" class="btn btn-primary btn-sm" value="<%= UI_DISPLAY_LANG.views.pages.global.save_changes_button %>">
            </div>

        </form>
        
	</div>

</div>

<script>

$(function()
{

var page_container = $('#create_inventory_confirmation_employees')

if ( !page_container[0] ) return

var ERROR_BOX = page_container.find('#ERROR_BOX')

const create_form = page_container.find('#create_form')
const inventory_select = page_container.find('#inventory_select')
const employee_select = page_container.find('#employee_select')

const addToListBTN = page_container.find('#addToListBTN')
const tableElement = page_container.find('#tableElement')

// create_form
create_form.on('submit', async e =>
{
    e.preventDefault()

    create_form.find(':submit').addClass('disabled')

    var res = await CLINIC_MODEL.inventory_confirmation_employees_batchStore({
        collection: selected()
    })

    create_form.find(':submit').removeClass('disabled')

    CreateToast('PS', res.message, '')

    if ( res.code == 404 ) return

    clearList()
})
// add to list
addToListBTN.on('click', e =>
{
    // check inventory
    if ( isNull( inventory_select.find(':selected').val() ) )
    {
        CreateToast('PS', FUI_DISPLAY_LANG.views.messages.invalid_inventory_selected, '')
        return
    }
    // check employee
    if ( isNull( employee_select.find(':selected').val() ) )
    {
        CreateToast('PS', FUI_DISPLAY_LANG.views.messages.invalid_employee_selected, '')
        return
    }

    addToList({
        center_id: inventory_select.find(':selected').val(),
        center_name: inventory_select.find(':selected').text(),
        employee_id: employee_select.find(':selected').val(),
        employee_name: employee_select.find(':selected').text(),
    })
})
//
function addToList(options)
{

    // check row exists
    if ( tableElement.find(`#row_${options.center_id}_${options.employee_id}`)[0] )
    {
        return
    }

    html =
    `
    <tr class="js_deletable_list_item" data-role="row" id="row_${options.center_id}_${options.employee_id}" data-center-id="${options.center_id}" data-center-name="${options.center_name}" data-employee-id="${options.employee_id}" data-employee-name="${options.employee_name}">
        <td>
            <button class="btn-close js_deletable_list_item__delete_button"></button>
        </td>
        <td>${options.center_name}</td>
        <td>${options.employee_name}</td>
    </tr>
    `

    tableElement.find('tbody').append(html)
    // dispatch_onNewAjaxContentLoaded()
    dispatch_onNewAjaxContentLoaded()
}
// 
function clearList()
{
    tableElement.find('tbody').html('')
}
// selected
function selected()
{
    var list = []

    var items = tableElement.find('[data-role="row"]')

    for (let i = 0; i < items.length; i++) 
    {
        const parent = $(items[i])
        
        list.push({
            administration_id: USER_CONFIG.administration.clinicId,
            administration_name: USER_CONFIG.administration.clinicName,
            center_id: parent.data('center-id'),
            center_name: parent.data('center-name'),
            employee_id: parent.data('employee-id'),
            employee_name: parent.data('employee-name'),
        })
    }

    return list
}

})

</script>