<div class="container-fluid" id="sendHiddenMessageContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.send_message.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<div class="WRAPPER" id="sendToEmployeeWrapper">
			<form action="#" id="sendMSGToEmployeeForm">
				<div class="mb-2">
					<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.send_message.form01.label05 %></label>
					<input type="text" class="input-text input-text-outline" id="employeePhoneInput">
				</div>
				<div class="mb-2">
					<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.send_message.form01.label02 %></label>
					<input type="text" class="input-text input-text-outline" id="subjectInput" placeholder="<%= UI_DISPLAY_LANG.views.pages.send_message.form01.ph01 %>">
				</div>
				<div class="mb-2">
					<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label4 %></label>
					<textarea class="input-text input-text-outline" rows="5" id="bodyInput" placeholder="<%= UI_DISPLAY_LANG.views.pages.send_message.form01.ph02 %>"></textarea>
				</div>
                <div class="mb-2">
					<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.select_file %></label>
					<input type="file" class="input-text input-text-outline" id="attachmentsInput" multiple>
				</div>
				<div class="">
					<input type="submit" class="btn btn-primary btn-sm" value="<%= UI_DISPLAY_LANG.views.pages.send_message.form01.submitBTN01 %>">
				</div>
			</form>
		</div>

	</div>
</div>

<script>

$(function()
{

var sendMessageContainer = $('#sendHiddenMessageContainer');
if ( sendMessageContainer[0] == undefined )
    return;

var ERROR_BOX = sendMessageContainer.find('#ERROR_BOX');

var sendMSGToEmployeeForm = sendMessageContainer.find('#sendMSGToEmployeeForm');
var employeePhoneInput = sendMessageContainer.find('#employeePhoneInput');
var subjectInput = sendMessageContainer.find('#subjectInput');
var bodyInput = sendMessageContainer.find('#bodyInput');
var attachmentsInput = sendMessageContainer.find('#attachmentsInput');

// send to manager
sendMSGToEmployeeForm.off('submit');
sendMSGToEmployeeForm.on('submit', async e =>
{
    e.preventDefault();
    var target = sendMSGToEmployeeForm;

    //display loader
    if ( FUI_DISPLAY_LANG.lang == 'ar' )
        TopLoader("جاري استرجاع الرمز التسلسلي للمستلم...");
    else if ( FUI_DISPLAY_LANG.lang == 'fr' )
        TopLoader("Récupérer le code de série du destinataire...");

    var response = await EMPLOYEE_MODEL.show( '', $.trim(employeePhoneInput.val()) );
    // hide loader
    TopLoader("", false);
    if ( response.code == 404 )
    {
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
        return;
    }

    var MessageObject = {
        sender: USER_CONFIG.employee_hash,
        receiver: response.data.employee_hash,
        subject: subjectInput.val(),
        body: bodyInput.val(),
        type: MESSAGE_TYPE_COMPLAIN
    };
    if ( attachmentsInput[0].files.length > 0 ) MessageObject.attachments = attachmentsInput[0].files
    // display loader
    if ( FUI_DISPLAY_LANG.lang == 'ar' )
        TopLoader("يتم ارسال الرسالة...");
    else if ( FUI_DISPLAY_LANG.lang == 'fr' )
        TopLoader("Le message est envoyé...");

    var response = await MESSAGE_MODEL.send(MessageObject)
    
    // hide loader
    TopLoader('', false);
    if ( response.code == 404 )
    {
        ERROR_BOX.show(0).delay(7*1000).hide(0)
        .find('#text').text(response.message);
        return;
    }
    ERROR_BOX.show(0).delay(7*1000).hide(0)
    .find('#text').text(response.message);
    // reset
    target[0].reset();
    
});
// employeePhoneInput
employeePhoneInput.off('dblclick');
employeePhoneInput.on('dblclick', e =>
{
    SelectEmployeeDialog(data =>
    {
        employeePhoneInput.val(data.employee_phone);
    });
});

})

</script>