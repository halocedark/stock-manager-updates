<div class="container-fluid" id="addClinicsContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.add_clinics.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block" id="wrapper01">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<form action="#" id="addForm">
			<div class="row gx-4 gy-4">
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label01 %></label>
						<input type="text" class="input-text input-text-outline" id="nameInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label02 %></label>
						<input type="text" class="input-text input-text-outline" id="phoneInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<%- include(SETTINGS.UI_Settings.MAIN_DIR_NAME+'views/templates/select-wilaya-baladia2.template.ejs', {
						componentId: 'wilaya_baladia_component',
						wilayaSelectId: 'wilaya_select',
						baladiaInputId: 'baladia_input',
						addressInputId: 'address_input',
						eventsReceiverId: 'addClinicsContainer',
					}) -%>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label8 %></label>
						<input type="email" class="input-text input-text-outline" id="emailInput">
					</div>	
				</div>
			</div>
			<div class="mt-3">
				<input type="submit" class="btn btn-primary btn-sm shadow" value="<%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.submitBTN01 %>">
			</div>
		</form>
	</div>
</div>


<script>

$(async function()
{

var page_container = $('#addClinicsContainer');
if ( page_container[0] == undefined ) return;

var ERROR_BOX = page_container.find('#ERROR_BOX');

var addForm = page_container.find('#addForm');
var nameInput = addForm.find('#nameInput');
var phoneInput = addForm.find('#phoneInput');
var wilaya_select = addForm.find('#wilaya_select');
var baladia_input = addForm.find('#baladia_input');
var address_input = addForm.find('#address_input');
var emailInput = addForm.find('#emailInput');

var wrapper01 = page_container.find('#wrapper01');

var ClinicObject = {
	clinicId: sessionData(true).clinicId
};
// addForm submit
addForm.off('submit');
addForm.on('submit', e =>
{
	e.preventDefault();
	var target = addForm;
	ClinicObject.clinicName = nameInput.val();
	ClinicObject.clinicPhone  = phoneInput.val();
	ClinicObject.clinicState  = wilaya_select.find(':selected').val();
	ClinicObject.clinicBaladia = baladia_input.val();
	ClinicObject.clinicAddress = address_input.val();
	ClinicObject.clinicEmail = emailInput.val();
	// display loader
	SectionLoader(wrapper01);
	// update
	if ( ClinicObject.clinicId != null )
	{
		CLINIC_MODEL.update(ClinicObject).then(response =>
		{
			// hide loader
			SectionLoader(wrapper01, '');
			if ( response.code == 404 )
			{
				ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
				return;
			}
			ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
			//
			target[0].reset();
			ClinicObject.clinicId = null;
		});
		return;	
	}
	// add
	CLINIC_MODEL.store(ClinicObject).then(response =>
	{
		// hide loader
		SectionLoader(wrapper01, '');
		if ( response.code == 404 )
		{
			ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
			return;
		}
		ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
		//
		target[0].reset();
	});
});
// wilaya-selected-first-time
wilaya_select.off('wilaya-selected-first-time').on('wilaya-selected-first-time', async e =>
{
	var detail = e.originalEvent.detail

	if ( detail.eventsReceiverId != 'addClinicsContainer' ) return

	displayOne();
})

//
// displayOne();
async function displayOne()
{
	if ( ClinicObject.clinicId == null )
		return;

	// display loader
	SectionLoader(wrapper01);
	var response = await CLINIC_MODEL.show(ClinicObject.clinicId);
	// hide loader
	SectionLoader(wrapper01, '');
	if ( response.code == 404 )
		return;

	var data = response.data;
	nameInput.val( data.clinicName );
	phoneInput.val( data.clinicPhone );
	setOptionSelected(wilaya_select, data.clinicState);

	baladia_input.val( data.clinicBaladia );
	address_input.val( data.clinicAddress );
	emailInput.val( data.clinicEmail );
}

})

</script>