<div class="container-fluid" id="allEmployeescashoutRecordsContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.sectionTitle %></h1>
	</div>
	<div class="alert alert-info mt-3 mb-2" style="display:none;" id="ERROR_BOX">
		<img src="assets/img/utils/info.png" class="alert-icon" alt="">
		<div class="alert-text" id="text"></div>
	</div>
	<div class="mt-3 app-block WRAPPER" id="wrapper01">
		<div class="table-nav">
			<div class="row gx-4 gy-3">
				<div class="col-lg-4 col-md-6 col-sm-12">
					<div class="form-field-01">
						<div class="form-field-icon-holder" id="searchBTN">
							<img src="assets/img/utils/search.svg" class="form-field-icon" alt="">	
						</div>
						<div class="form-field-input-holder">
							<input type="text" id="searchInput" class="form-field-input" placeholder="<%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.ph01 %>">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 col-sm-12">
					<div class="form-field-01">
						<div class="form-field-input-holder">
							<div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.label01 %></div>
							<input type="date" id="fromDateInput" class="form-field-input">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 col-sm-12">
					<div class="form-field-01">
						<div class="form-field-input-holder">
							<div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.label02 %></div>
							<input type="date" id="toDateInput" class="form-field-input">
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 col-sm-12">
					<button class="btn btn-danger btn-sm" id="deleteSelectedBTN">
						<i class="fas fa-trash"></i>
					</button>
				</div>
			</div>
		</div>
		<div id="pagination1" class="my-3 flex flex-center"></div>
		<div class="utable shadowed" id="tableElement1">
			<div class="thead">
				<div class="td">#</div>
				<div class="td"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.th01 %></div>
				<div class="td"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.th02 %></div>
				<div class="td"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.th03 %></div>
				<div class="td"><%= UI_DISPLAY_LANG.views.pages.all_employees_cashout_records.th04 %></div>
			</div>
			<div class="tbody">
				<!--
				<div class="tr" data-role="ROW">
					<div class="td">
						<input type="checkbox" class="form-check-input" data-role="CHECK" data-id="">
					</div>
					<div class="td">name</div>
					<div class="td">ccp</div>
					<div class="td">amount</div>
					<div class="td">date</div>
				</div>
				-->
			</div>
		</div>
	</div>
</div>

<script>

$(function()
{

var allEmployeescashoutRecordsContainer = $('#allEmployeescashoutRecordsContainer');
if ( allEmployeescashoutRecordsContainer[0] == undefined )
    return;

var ERROR_BOX = allEmployeescashoutRecordsContainer.find('#ERROR_BOX');
var searchBTN = allEmployeescashoutRecordsContainer.find('#searchBTN');
var searchInput = allEmployeescashoutRecordsContainer.find('#searchInput');
var fromDateInput = allEmployeescashoutRecordsContainer.find('#fromDateInput');
var toDateInput = allEmployeescashoutRecordsContainer.find('#toDateInput');
var deleteSelectedBTN = allEmployeescashoutRecordsContainer.find('#deleteSelectedBTN');
var pagination1 = allEmployeescashoutRecordsContainer.find('#pagination1');
var tableElement1 = allEmployeescashoutRecordsContainer.find('#tableElement1');

var wrapper01 = allEmployeescashoutRecordsContainer.find('#wrapper01');

// tableElement1 click
tableElement1.off('click');
tableElement1.on('click', e =>
{
    var target = $(e.target);
    if ( target.data('role') == 'ROW' )
    {
        var check = target.find('[data-role="CHECK"]');
        toggleCheck(check);
    }
});
// delete
deleteSelectedBTN.off('click');
deleteSelectedBTN.on('click', e =>
{
    PromptConfirmDialog().then(async c =>
    {
        SectionLoader(tableElement1);
        var response = await CASHOUT_RECORD_MODEL.batchDelete( selectedRows() );
        SectionLoader(tableElement1, '');
        if ( response.code == 404 )
        {
            ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
            return;
        }
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
        displayAll();
    });
});
// search
searchBTN.off('click');
searchBTN.on('click', async e =>
{
    var SearchObject = {
        query: searchInput.val(),
        administration_id: USER_CONFIG.administration.clinicId,
        advanced: {
            start: fromDateInput.val(),
            end: toDateInput.val(),
        }
    };

    SectionLoader(tableElement1);
    var response = await CASHOUT_RECORD_MODEL.administration_search(SearchObject);
    SectionLoader(tableElement1, '');
    // clear html
    tableElement1.find('.tbody').html('');
    if ( response.code == 404 )
        return;

    var data = response.data;
    var html = '';
    $.each(data, (k,v) =>
    {
        html += `<div class="tr" data-role="ROW">
                    <div class="td">
                        <input type="checkbox" class="form-check-input" data-role="CHECK" data-id="${v.id}">
                    </div>
                    <div class="td">${v.employee_name}</div>
                    <div class="td">${v.employee_ccp}</div>
                    <div class="td">${parseFloat(v.cashout_amount).toFixed(2)}</div>
                    <div class="td">${v.cashout_date} ${v.cashout_time}</div>
                </div>PAG_SEP`;
    });
    // add html
    var options = {
        data: html.split('PAG_SEP')
    };
    new SmoothPagination(pagination1, tableElement1.find('.tbody'), options);
});
searchInput.off('keyup');
searchInput.on('keyup', async e =>
{
    var SearchObject = {
        query: searchInput.val(),
        administration_id: USER_CONFIG.administration.clinicId
    };

    SectionLoader(tableElement1);
    var response = await CASHOUT_RECORD_MODEL.administration_search(SearchObject);
    SectionLoader(tableElement1, '');
    // clear html
    tableElement1.find('.tbody').html('');
    if ( response.code == 404 )
        return;

    var data = response.data;
    var html = '';
    $.each(data, (k,v) =>
    {
        html += `<div class="tr" data-role="ROW">
                    <div class="td">
                        <input type="checkbox" class="form-check-input" data-role="CHECK" data-id="${v.id}">
                    </div>
                    <div class="td">${v.employee_name}</div>
                    <div class="td">${v.employee_ccp}</div>
                    <div class="td">${parseFloat(v.cashout_amount).toFixed(2)}</div>
                    <div class="td">${v.cashout_date} ${v.cashout_time}</div>
                </div>PAG_SEP`;
    });
    // add html
    var options = {
        data: html.split('PAG_SEP')
    };
    new SmoothPagination(pagination1, tableElement1.find('.tbody'), options);
});
// display all
displayAll();
function displayAll()
{
    searchInput.trigger('keyup');
}
// selected rows
function selectedRows()
{
    var list = [];
    var items = tableElement1.find('[data-role="CHECK"]');
    for (var i = 0; i < items.length; i++) 
    {
        var check = $(items[i]);
        if ( check.is(':checked') )
            list.push({id: check.data('id')});
    }

    return list;
}

})

</script>