<div class="container-fluid" id="prescriptionsStatsContainer">
	<div class="wrapper">

	</div>
	<div class="mt-3">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
	</div>
	<div class="app-block my-3">
        <div class="row gx-4 gy-3">
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="form-field-01">
                    <div class="form-field-icon-holder" id="search_btn">
                        <img src="assets/img/utils/search.svg" class="form-field-icon" alt="">	
                    </div>
                    <div class="form-field-input-holder">
                        <input type="text" id="search_input" class="form-field-input" placeholder="<%= UI_DISPLAY_LANG.views.pages.global.placeholder5 %>">
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="form-field-01 disabled">
                    <div class="form-field-input-holder">
                        <div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.global.label5 %></div>
                        <input type="date" id="start_input" class="form-field-input">
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="form-field-01 disabled">
                    <div class="form-field-input-holder">
                        <div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.global.label6 %></div>
                        <input type="date" id="end_input" class="form-field-input">
                    </div>
                </div>
            </div>
        </div>
	</div>

    <div class="app-block mt-3 d-none">
        <ul class="list-group list-group-flush" id="more_details_list">
            <!-- <li class="list-group-item">An item</li>
            <li class="list-group-item">A second item</li>
            <li class="list-group-item">A third item</li>
            <li class="list-group-item">A fourth item</li>
            <li class="list-group-item">And a fifth one</li> -->
        </ul>
    </div>

    <div class="app-block mt-3">
        <div id="pagination" class="flex flex-center my-3"></div>
        <div class="table-div">
            <div class="utable odd-columns" id="table_element">
                <div class="thead">
                    <div class="td"><%= UI_DISPLAY_LANG.views.pages.global.th10 %></div>
                    <div class="td"><%= UI_DISPLAY_LANG.views.pages.global.th9 %></div>
                    <div class="td"><%= UI_DISPLAY_LANG.views.pages.global.th6 %></div>
                </div>
                <div class="tbody">
                    <!-- <div class="tr">
                        <div class="td">
                            <img src="" class="img-02" alt="">
                        </div>
                        <div class="td">name</div>
                        <div class="td">date</div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>

</div>

<script>

$(function()
{

var page_container = $('#prescriptionsStatsContainer')
var ERROR_BOX = page_container.find('#ERROR_BOX')

var search_btn = page_container.find('#search_btn')
var search_input = page_container.find('#search_input')
var start_input = page_container.find('#start_input')
var end_input = page_container.find('#end_input')

var more_details_list = $('#more_details_list')
var pagination = page_container.find('#pagination')
var table_element = page_container.find('#table_element')

start_input.val(CURRENT_DATE)
end_input.val(CURRENT_DATE)
// search
search_input.on('keyup', e =>
{
    displayAll()
})
// display all
displayAll()
async function displayAll()
{
    var res = await searchPrescriptionCreatedByEmployee({
        query: search_input.val(),
        start: start_input.val(),
        end: end_input.val(),
    })

    if ( res.code == 404 )
        return
        
    var data = res.data
    var html = ''
    var total_presc = data.length
    var last_presc = data[0]

    $.each(data, (k,v) =>
    {
        html += `<div class="tr">
                    <div class="td">
                        <img src="${v.prescriptionQRCode}" class="img-02" alt="">
                    </div>
                    <div class="td">${v.patientName}</div>
                    <div class="td">${v.prescriptionDate} | ${v.prescriptionTime}</div>
                </div>PAG_SEP`
    })
    // add html
    var options = {
        data: html.split('PAG_SEP'),
        resultsPerPage: 9
    };
    new SmoothPagination(pagination, table_element.find('.tbody'), options);
    // more details
    more_details_list.parent().removeClass('d-none')
    if ( FUI_DISPLAY_LANG.lang == 'ar' )
    {
        more_details_list.html(`
            <li class="list-group-item">اجمالي: ${total_presc} وصفات طبية</li>
            <li class="list-group-item">
                آخر وصفة طبية ل ${last_presc.patientName} (${last_presc.patientPhone})
                في ${last_presc.prescriptionDate} | ${last_presc.prescriptionTime}
            </li>
        `)
    }
    else if ( FUI_DISPLAY_LANG.lang == 'fr' )
    {
        more_details_list.html(`
            <li class="list-group-item">Total: ${total_patients} clients</li>
            <li class="list-group-item">
                dernier client: ${last_patient.patientName} (${last_patient.patientPhone})
                dans ${last_patient.patientDate} | ${last_patient.patientTime}
            </li>
        `)
    }
}

})

</script>