<div class="container-fluid" id="productsStatsContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.products_stats.sectionTitle %></h1>
	</div>
	<div class="mt-3">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
	</div>
	<div class="app-block mt-2">
		<div class="form-field-01 my-2">
			<div class="form-field-icon-holder" id="searchBTN">
				<img src="assets/img/utils/search.svg" class="form-field-icon" alt="">	
			</div>
			<div class="form-field-input-holder">
				<input type="text" id="searchInput" class="form-field-input" placeholder="<%= UI_DISPLAY_LANG.views.pages.products_stats.ph01 %>">
			</div>
		</div>
		<div id="pagination" class="my-3 flex flex-center"></div>
		<div id="mostSellsDiv" class="row gx-4 gy-3" style="">
			<!--
			<div class="col-lg-12 col-md-12 col-sm-12" data-role="PRODUCT" data-productid="">
				<div class="row gx-2 gy-3">
					<div class="col-md-1 text-center">
						<img src="assets/img/utils/placeholder.jpg" alt="" class="img-05">
					</div>
					<div class="col-md">
						<div class="d-inline-flex w-100 h-100 flex-align-center">
							<div class="text-03">
								Product name
								<span class="text-04">450.00 DA</span>
								<span class="text-04 text-muted">(15) times</span>
							</div>
						</div>
					</div>
				</div>
			</div>	
			-->
		</div>
	</div>
	<!--
	<div class="app-block mt-2">
		<div class="table-nav">
			<input type="text" class="input-text input-text-outline" id="searchInput" placeholder="<%= UI_DISPLAY_LANG.views.pages.products_stats.ph01 %>">
		</div>
		<div id="pagination" class="my-3 flex flex-center"></div>
		<div class="table-div">
			<div class="utable odd-columns" id="tableElement">
				<div class="thead">
					<div class="td"><%= UI_DISPLAY_LANG.views.pages.products_stats.th01 %></div>
					<div class="td"><%= UI_DISPLAY_LANG.views.pages.products_stats.th02 %></div>
					<div class="td"><%= UI_DISPLAY_LANG.views.pages.products_stats.th03 %></div>
				</div>
			</div>
		</div>
	</div>
	-->
</div>

<script>

$(function()
{

var productsStatsContainer = $('#productsStatsContainer');
if ( productsStatsContainer[0] == undefined )
    return;

var ERROR_BOX = productsStatsContainer.find('#ERROR_BOX');

var searchBTN = productsStatsContainer.find('#searchBTN');
var searchInput = productsStatsContainer.find('#searchInput');
var pagination = productsStatsContainer.find('#pagination');
var mostSellsDiv = productsStatsContainer.find('#mostSellsDiv');

// search
searchBTN.off('click');
searchBTN.on('click', e =>
{
    displayAll();
});
searchInput.off('keyup');
searchInput.on('keyup', async e =>
{
    SectionLoader(mostSellsDiv);
    var response = await searchProductsLocal({
        clinicId: USER_CONFIG.administration.clinicId,
        query: searchInput.val(),

    });
    SectionLoader(mostSellsDiv, '');
    mostSellsDiv.html('');
    if ( response.code == 404 )
        return;

    var data = response.data;
    var html = '';
    $.each(data, (k,v) =>
    {
        var productImageUrl = (v.productImageData) ? JSON.parse(v.productImageData).url : 'assets/img/utils/placeholder.jpg';
        if ( FUI_DISPLAY_LANG.lang == 'ar' )
        {
            html += `<div class="col-lg-12 col-md-12 col-sm-12" data-role="PRODUCT" data-productid="${v.productId}">
                        <div class="row gx-2 gy-3">
                            <div class="col-md-1 text-center">
                                <img src="${productImageUrl}" alt="" class="img-05">
                            </div>
                            <div class="col-md">
                                <div class="d-inline-flex w-100 h-100 flex-align-center">
                                    <div class="text-03">
                                        ${v.productName}
                                        <span class="text-04 text-muted">تم شراء المنتج  (${v.stats.sales.total}) مرة</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>PAG_SEP`;
        }
        else if ( FUI_DISPLAY_LANG.lang == 'fr' )
        {
            html += `<div class="col-lg-12 col-md-12 col-sm-12" data-role="PRODUCT" data-productid="${v.productId}">
                        <div class="row gx-2 gy-3">
                            <div class="col-md-1 text-center">
                                <img src="${productImageUrl}" alt="" class="img-05">
                            </div>
                            <div class="col-md">
                                <div class="d-inline-flex w-100 h-100 flex-align-center">
                                    <div class="text-03">
                                        ${v.productName}
                                        <span class="text-04 text-muted">Produit acheté (${v.stats.sales.total}) fois</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>PAG_SEP`;
        }
    });

    var options = {
        data: html.split('PAG_SEP'),
        resultsPerPage: 10
    };
    new SmoothPagination(pagination, mostSellsDiv, options);
});
// display all
displayAll();
function displayAll()
{
    searchInput.trigger('keyup');
}

})

</script>