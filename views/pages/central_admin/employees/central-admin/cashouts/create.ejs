<div class="container-fluid" id="employeesAccountingContainer">
	<div class="wrapper">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.employees_accounting.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block" id="wrapper01">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<form action="#" id="addForm">
			<div class="row gx-4 gy-4">
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="mb-2 section">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.label01 %></label>
						<input type="text" class="input-text input-text-outline border-bottom-forced mb-2" placeholder="<%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.ph01 %>" id="employeesSearchInput">
						<select name="" class="select-01" id="employeeSelect"></select>
					</div>
					<div class="mb-3">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.label02 %></label>
						<input type="number" step="any" min="0" value="0" class="input-text input-text-outline" id="cashoutAmountInput">
					</div>
					<div class="mb-3">
						<div class="form-field-01">
							<div class="form-field-input-holder">
								<div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.label03 %></div>
								<input type="date" id="paymentDateInput" class="form-field-input">
							</div>
						</div>
					</div>
					<div class="mb-2">
						<div class="form-field-01">
							<div class="form-field-input-holder">
								<div class="form-field-label"><%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.label04 %></div>
								<input type="time" step="any" id="paymentTimeInput" class="form-field-input">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="">
				<input type="submit" class="btn btn-primary btn-sm shadow" value="<%= UI_DISPLAY_LANG.views.pages.employees_accounting.form01.submitBTN01 %>">
			</div>
		</form>
	</div>
</div>

<script>

$(function()
{

var employeesAccountingContainer = $('#employeesAccountingContainer');
if ( employeesAccountingContainer[0] == undefined )
    return;

var ERROR_BOX = employeesAccountingContainer.find('#ERROR_BOX');
var addForm = employeesAccountingContainer.find('#addForm');
var employeesSearchInput = addForm.find('#employeesSearchInput');
var employeeSelect = addForm.find('#employeeSelect');
var cashoutAmountInput  = addForm.find('#cashoutAmountInput');
var paymentDateInput = addForm.find('#paymentDateInput');
var paymentTimeInput = addForm.find('#paymentTimeInput');

var wrapper01 = employeesAccountingContainer.find('#wrapper01');
// initialize data and time
var now = new Date();
paymentDateInput.val( date_time.format(now, 'YYYY-MM-DD') );
paymentTimeInput.val( date_time.format(now, 'HH:mm:ss') );

var CashoutRecordObject = {};
// addForm submit
addForm.off('submit');
addForm.on('submit', e =>
{
    e.preventDefault();
    var target = addForm;
    CashoutRecordObject.employee_id = employeeSelect.find(':selected').val();
    CashoutRecordObject.cashout_amount = cashoutAmountInput.val();
    CashoutRecordObject.cashout_date = paymentDateInput.val();
    CashoutRecordObject.cashout_time = paymentTimeInput.val();
    // display loader
    SectionLoader(wrapper01);
    // add
    CASHOUT_RECORD_MODEL.store(CashoutRecordObject).then(response =>
    {
        // hide loader
        SectionLoader(wrapper01, '');
        if ( response.code == 404 )
        {
            ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
            return;
        }
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
        target[0].reset();
        paymentDateInput.val( date_time.format(now, 'YYYY-MM-DD') );
        paymentTimeInput.val( date_time.format(now, 'HH:mm:ss') );
    });
});
// search employees
employeesSearchInput.off('keyup');
employeesSearchInput.on('keyup', async e =>
{
    var SearchObject = {
        query: employeesSearchInput.val(),
        employee_administration:'.'
    };
    SectionLoader(wrapper01);
    var response = await EMPLOYEE_MODEL.searchLocal(SearchObject);
    SectionLoader(wrapper01, '');
    if ( response.code == 404 )
        return;

    var data = response.data;
    var html = '';
    $.each(data, (k,v) =>
    {
        html += `<option value="${v.employee_id}">${v.employee_name}</option>`;
    });
    employeeSelect.html(html);
});
employeesSearchInput.trigger('keyup');

})

</script>