<div class="container-fluid" id="allMedicalAnalysis_page">
	<div class="wrapper d-none">
		<h1 class="title-medium"></h1>
	</div>
	
	<div class="mt-3">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>

        <!-- <div class="table-nav">

            <div class="mb-2">
				<button class="btn btn-danger btn-sm" id="deleteSelectedBTN" data-perm="delete_medical_analysis">
					<%= UI_DISPLAY_LANG.views.pages.global.delete_selected_button %>
				</button>
			</div>

        </div> -->

		<div id="pagination" class="my-3 flex flex-center"></div>
		<div id="table_element" class="row gx-4 gy-5">
			
            <!-- <div class="col-lg-4 col-md-6">

                <h5 class="h4 mb-3"></h5>

                <ul class="list-group list-group-flush">
                    <li class="list-group-item">An item</li>
                    <li class="list-group-item">A second item</li>
                    <li class="list-group-item">A third item</li>
                    <li class="list-group-item">A fourth item</li>
                    <li class="list-group-item">And a fifth one</li>
                </ul>

            </div> -->

		</div>
	</div>

</div>

<script>

$(function()
{

var page_container = $('#allMedicalAnalysis_page')
if ( !page_container[0] ) return

var ERROR_BOX = page_container.find('#ERROR_BOX')
var deleteSelectedBTN = page_container.find('#deleteSelectedBTN')
var pagination = page_container.find('#pagination')
var table_element = page_container.find('#table_element')
var medical_analysis_category = new MedicalAnalysisCategoryModel()

// delete selected
deleteSelectedBTN.on('click', e =>
{
    PromptConfirmDialog().then(async c =>
    {
        SectionLoader(table_element)
        var res = await MEDICAL_ANALYSIS_MODEL.batchDelete({
            list: selectedRows()
        })
        SectionLoader(table_element, '')
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(res.message);
        displayAll()
    })
})
// table_element
table_element.on('click', e =>
{
    var target = $(e.target)

    if ( target.data('role') == 'EDIT' )
    {
        var medical_analysis = target.closest('[data-role="medical_analysis"]')

        goToPage('create-medical-analysis', {
            id: medical_analysis.data('id')
        })
    }
})
// display all
displayAll()
async function displayAll()
{
    var res = await medical_analysis_category.index()

    if ( res.code == 404 ) return

    var data = res.data
    var html = ''

    for (let i = 0; i < data.length; i++) 
    {
        const category = data[i];
        
        html += `<div class="col-lg-4 col-md-6" data-role="row" data-id="${category.id}">
                    <h5 class="h4 mb-3">${category.name}</h5>`

        if ( category.medical_analyses )
        {
            html += `<ul class="list-group list-group-flush">`
            for (let j = 0; j < category.medical_analyses.length; j++) 
            {
                const medical_analysis = category.medical_analyses[j];
                
                html += `<li class="list-group-item d-flex is-justify-content-space-between" data-role="medical_analysis" data-id="${medical_analysis.id}">
                            <div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" data-role="check" id="checkbox_${medical_analysis.id}">
                                    <label class="form-check-label text-03" for="checkbox_${medical_analysis.id}">
                                        ${medical_analysis.name}
                                    </label>
                                </div>    
                            </div>
                            <div>
                                <button type="button" class="btn btn-primary btn-sm" data-role="EDIT" data-perm="update_medical_analysis">
                                    <span class="no-pointer"><i class="fas fa-edit"></i></span>
                                </button>
                            </div>
                        </li>`
            }
            html+= `</ul>`
        }

        html += `</div>PAG_SEP`
    }

    new SmoothPagination(pagination, table_element, {
        data: html.split('PAG_SEP')
    })
}
// selected rows
function selectedRows()
{
    var list = [];
    var items = table_element.find('[data-role="medical_analysis"]');
    for (var i = 0; i < items.length; i++) 
    {
        var parent = $(items[i]);
        var check = parent.find('[data-role="check"]')

        if ( check.is(':checked') )
            list.push({
                id: parent.data('id')
            });
    }

    return list;
}

})

</script>