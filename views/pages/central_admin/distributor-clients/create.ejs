<div class="container-fluid" id="create_distributor_clients_container">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.add_employees.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block" id="wrapper01">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<form action="#" id="create_form">

            <div class="row">

                <div class="col-lg-6 col-md-6">

                    <div class="mb-2">
                        <%- include(`${SETTINGS.UI_Settings.MAIN_DIR_NAME}/views/templates/select-distributors.template.ejs`, {
                            eventsReceiverId: 'create_distributor_clients_container'
                        }) -%>
                    </div>
        
                    <div class="mb-2">
                        <label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label1 %></label>
                        <input type="text" class="input-text" id="name_input" value="">
                    </div>
        
                    <div class="mb-2">
                        <label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label2 %></label>
                        <input type="text" class="input-text" id="phone_input" value="">
                    </div>
        
                    <div class="mb-2 max-width-340px">
                        
                        <!-- <input type="text" class="input-text" id="codeInput" value=""> -->
                        <%- include(`${SETTINGS.UI_Settings.MAIN_DIR_NAME}/views/templates/select-wilaya-baladia.template.ejs`, {
                            componentId: 'location_component',
                            eventsReceiverId: 'create_distributor_clients_container',
                            wilayaSelectionName: 'wilaya-selected',
                            baladiaSelectionName: 'baladia-selected',
                            searchWilayaInputId: 'wilaya_input',
                            searchBaladiaInputId: 'baladia_input',
                        }) -%>
                    </div>
        
                    <div class="mb-2">
                        <label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label50 %></label>
                        <input type="text" class="input-text" id="address_input" value="">
                    </div>

                    <div class="mb-2 max-width-340px">
                        
                        <label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label51 %></label>
                        <%- include(`${SETTINGS.UI_Settings.MAIN_DIR_NAME}/views/templates/select-location.template.ejs`, {
                            componentId: 'coordinates_component',
                            searchInputId: 'coordinates_input',
                            eventsReceiverId: 'create_distributor_clients_container',
                        }) -%>
                    </div>

                </div>

                <div class="col-lg-6 col-md-6">

                    <div class="mb-2">
                        <label for="" class="form-label">RC</label>
                        <input type="text" class="input-text" id="RC_input" value="">
                    </div>
        
                    <div class="mb-2">
                        <label for="" class="form-label">NIF</label>
                        <input type="text" class="input-text" id="NIF_input" value="">
                    </div>

                    <div class="mb-2">
                        <label for="" class="form-label">NIS</label>
                        <input type="text" class="input-text" id="NIS_input" value="">
                    </div>

                </div>

            </div>

			<div class="mt-3">
				<input type="submit" class="btn btn-primary btn-sm shadow" value="<%= UI_DISPLAY_LANG.views.pages.global.save_changes_button %>">
			</div>
		</form>
	</div>
</div>

<script>

$(async function()
{

var page_container = $('#create_distributor_clients_container');
if ( page_container[0] == undefined )
    return;

var ERROR_BOX = page_container.find('#ERROR_BOX');

var create_form = page_container.find('#create_form')
var select_distributors_template_distributor_select = create_form.find('#select_distributors_template_distributor_select')
var name_input = create_form.find('#name_input')
var phone_input = create_form.find('#phone_input')
var wilaya_input = create_form.find('#wilaya_input')
var baladia_input = create_form.find('#baladia_input')
var address_input = create_form.find('#address_input')
var coordinates_input = create_form.find('#coordinates_input')
var RC_input = create_form.find('#RC_input')
var NIF_input = create_form.find('#NIF_input')
var NIS_input = create_form.find('#NIS_input')

var ClientObject = {
    id: sessionData(true).id
}
// submit
create_form.on('submit', async e =>
{
    e.preventDefault()
    var target = create_form

    ClientObject.distributor_id = select_distributors_template_distributor_select.find(':selected').val()
    ClientObject.name = name_input.val()
    ClientObject.phone = phone_input.val()
    ClientObject.address = address_input.val()
    ClientObject.wilaya = wilaya_input.val()
    ClientObject.baladia = baladia_input.val()
    ClientObject.coordinates = coordinates_input.val()
    ClientObject.RC = RC_input.val()
    ClientObject.NIF = NIF_input.val()
    ClientObject.NIS = NIS_input.val()

    SectionLoader(create_form)

    // update
    if ( ClientObject.id )
    {
        var res = await EMPLOYEE_MODEL.distributor_client_update(ClientObject)

        SectionLoader(create_form, '')
        if ( res.code == 404 ) return

        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(res.message)
        target[0].reset()
        ClientObject.id = null
        return
    }
    // create
    var res = await EMPLOYEE_MODEL.distributor_client_store(ClientObject)

    SectionLoader(create_form, '')
    if ( res.code == 404 ) return

    ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(res.message)
    target[0].reset()
})
// location
$(document).off('location-selected').on('location-selected', e =>
{
    var detail = e.originalEvent.detail
    var _location = detail.location

    coordinates_input.val( _location.coordinates.lat+','+_location.coordinates.lng )
})
    
// display one
displayOne()
async function displayOne()
{
    if ( !ClientObject.id ) return

    var res = await EMPLOYEE_MODEL.distributor_client_show({
        id: ClientObject.id
    })

    var data = res.data

    name_input.val(data.name)
    phone_input.val(data.phone)
    address_input.val(data.address)
    wilaya_input.val(data.wilaya)
    baladia_input.val(data.baladia)
    coordinates_input.val(data.coordinates)
    RC_input.val(data.RC)
    NIF_input.val(data.NIF)
    NIS_input.val(data.NIS)

    $(document).off('distributor-selected').on('distributor-selected', e =>
    {
        var detail = e.originalEvent.detail
        
        setOptionSelected(select_distributors_template_distributor_select,data.distributor_id)
    })
  
}

})

</script>