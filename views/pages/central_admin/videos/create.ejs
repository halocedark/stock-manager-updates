<div class="container-fluid" id="addVideosContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.add_videos.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block" id="wrapper01">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<form action="#" id="addForm">
			<div class="row gx-4 gy-4">
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_videos.form01.label01 %></label>
						<input type="text" class="input-text input-text-outline" id="titleInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_videos.form01.label02 %></label>
						<textarea name="" id="descInput" class="input-text input-text-outline" rows="5"></textarea>
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_videos.form01.label03 %></label>
						<input type="text" class="input-text input-text-outline" id="urlInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_videos.form01.label04 %></label>
						<div class="section">
							<iframe width="560" height="315" id="livePreviewIframe" class="d-block" style="background-color:#f9f9f9;" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
						</div>
					</div>	
				</div>
			</div>
			<div class="mt-3">
				<input type="submit" class="btn btn-primary btn-sm shadow" value="<%= UI_DISPLAY_LANG.views.pages.add_videos.form01.submitBTN01 %>">
			</div>
		</form>
	</div>
</div>

<script>

$(function()
{

var page_container = $('#addVideosContainer');
if ( page_container[0] == undefined )
    return;

var ERROR_BOX = page_container.find('#ERROR_BOX');
var addForm = page_container.find('#addForm');
var titleInput = addForm.find('#titleInput');
var descInput = addForm.find('#descInput');
var urlInput = addForm.find('#urlInput');
var livePreviewIframe = addForm.find('#livePreviewIframe');

var wrapper01 = page_container.find('#wrapper01');

var VideoObject = {
    video_id: sessionData().video_id
};
// clear session data
sessionData(true)
// addForm submit
addForm.off('submit');
addForm.on('submit', async e =>
{
    e.preventDefault();
    var target = addForm;
    VideoObject.employee_id = USER_CONFIG.employee_id;
    VideoObject.video_url = urlInput.val();
    VideoObject.video_title = titleInput.val();
    VideoObject.video_desc = descInput.val();

    SectionLoader(wrapper01);
    // update
    if ( VideoObject.video_id != null )
    {
        var response = await VIDEO_MODEL.update(VideoObject)
        
        SectionLoader(wrapper01, '');
        if ( response.code == 404 )
        {
            ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
            return;
        }
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
        target[0].reset();
        VideoObject.video_id = null;
        
        return;
    }
    // add
    var response = await VIDEO_MODEL.store(VideoObject)

    SectionLoader(wrapper01, '');
    if ( response.code == 404 )
    {
        ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
        return;
    }
    ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
    target[0].reset();
});
// preview video
urlInput.off('input');
urlInput.on('input', e =>
{
    var url = 'https://www.youtube.com/embed/'+extractYTVideoId(urlInput.val())+'?rel=0';
    urlInput.val(url);
    previewVideo(url);
});
// preview Video
function previewVideo(url)
{
    livePreviewIframe.closest('.section').css('width', livePreviewIframe.css('width'))
    .css('height', livePreviewIframe.css('height'));
    SectionLoader(livePreviewIframe.closest('.section'));
    livePreviewIframe.attr('src', url);
    livePreviewIframe.off('load');
    livePreviewIframe.on('load', e =>
    {
        SectionLoader(livePreviewIframe.closest('.section'), '');
    });
}
// display one
displayOne();
async function displayOne()
{
    if ( VideoObject.video_id == null )
        return;

    var response = await VIDEO_MODEL.show(VideoObject.video_id);
    if ( response.code == 404 )
        return;

    var data = response.data;

    titleInput.val( data.video_title );
    descInput.val(data.video_desc);
    urlInput.val(data.video_url);
    previewVideo(data.video_url);
}

})

</script>